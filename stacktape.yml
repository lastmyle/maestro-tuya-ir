# Stacktape configuration for Maestro Tuya IR Bridge
# Deploy as Lambda function to AWS (add to existing stack or use standalone)

serviceName: maestro-ir-bridge

resources:
  # HTTP API Gateway for public access
  irApi:
    type: http-api-gateway
    properties:
      cors:
        enabled: true
        # Configure CORS for Hubitat, Admin, Customer apps
        allowedOrigins:
          - "*"  # TODO: Restrict to specific origins in production
        allowedHeaders:
          - "*"
        allowedMethods:
          - "*"

  # Lambda function (no VPC = serverless, pay-per-use)
  irBridgeFunction:
    type: function
    properties:
      packaging:
        type: stacktape-lambda-buildpack
        properties:
          entryfilePath: lambda_handler.py
      runtime: python3.12
      timeout: 15
      memory: 512
      environment:
        - name: ENVIRONMENT
          value: production
      events:
        # Route root path to Lambda (for Swagger UI at /)
        - type: http-api-gateway
          properties:
            httpApiGatewayName: irApi
            path: /
            method: GET
        # Route all other paths to Lambda
        - type: http-api-gateway
          properties:
            httpApiGatewayName: irApi
            path: /{proxy+}
            method: "*"
